<!--@author wychengpublic-->
{% extends "device_display/home.html" %}

{% load staticfiles %}

{% block css %}
<link href="{% static 'display/self_defined/css/search_result.css' %}" rel="stylesheet">
{% endblock %}

{% block main_container %}
<form role="form" method="post">
    {% csrf_token %}
    <div class="form-group row" id="search-group">
        <div class="col-sm-5" id="div_input">
            <input type="text" id="searchtext" name="search_text" value="{{ search_text }}" class="form-control"
                   pattern="[^\\,;]+" required oninvalid="setCustomValidity('搜索内容不能为空，且不包含特殊字符(\\，；)。')"
                   oninput="setCustomValidity('')">
            <input type="text" id="searchcat" name="search_category" hidden value="{{ search_category }}">
            <input type="text" name="page_index" value="{{ page_index }}" hidden>
            <input type="text" name="page_total" value="{{ page_total }}" hidden>
        </div>
        <div class="col-sm-1" id="div_btn">
            <button type="submit" class="btn btn-sm btn-primary btn-block">搜索</button>
        </div>
    </div>
</form>
<ul class="nav nav-tabs" id="nav_result_cat">
    <li class="cat active" id="cat_type"><a data-toggle="tab">类型</a></li>
    <li class="cat" id="cat_brand"><a data-toggle="tab">品牌</a></li>
    <li class="cat" id="cat_model"><a data-toggle="tab">型号</a></li>
    <li class="cat" id="cat_fingerprint"><a data-toggle="tab">指纹</a></li>
</ul>

{% include "device_display/result.html" %}

<script src="{% static 'display/self_defined/js/search_result.js' %}"></script>
<script>
    // post to get search_results
    function get_results(search_text, search_category, page_index) {
        var url = "{% url 'display:search' %}";
        $.post(url,
            {
                'search_text': search_text,
                'search_category': search_category,
                'page_index': page_index
            },
            function (data, status) {
                if (status === 'success') {
                    alert('success!,参数：' + search_text + "," + search_category + "," + page_index);
                    var result_json = eval('(' + data + ')');
                    show_intable(result_json);
                }else {
                    // 显示错误信息到页面
                    alert('请求失败了……');
                }
            });
    }
</script>
{% endblock %}