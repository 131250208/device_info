<p id="result_info">查找结果：{{ records_num }} 条&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;共 {{ page_total }} 页&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;耗时：{{search_time}}
    s</p>

<div class="container" id="results_container" ng-app="manager_app" ng-controller="validateCtrl">
    <div class="row group_gray">
        <div class="col-sm-4 col-sm-offset-8" style="text-align: right">
            {% ifequal identity 'admin' %}
            <button type="button" id="btn_add" class="btn btn-default btn-sm managers" data-toggle="collapse"
                    data-target="#add_editor">
                <span class="glyphicon glyphicon-chevron-down"></span> 添加
            </button>
            <button type="button" id="btn_edit" class="btn btn-default btn-sm managers">
                <span class="glyphicon glyphicon-pencil"></span> 修改
            </button>
            <button type="button" id="btn_delete" class="btn btn-default btn-sm managers">
                <span class="glyphicon glyphicon-trash"></span> 删除
            </button>
            {% endifequal %}
            <button type="button" id="btn_export" class="btn btn-default btn-sm managers">
                <span class="glyphicon glyphicon-download-alt"></span>
                导出
            </button>
        </div>
    </div>
    <div id="add_editor_category" class="row collapse">
        <form role="form" name="add_editor_category" novalidate >
            {% csrf_token %}
            <div class="container">
                <div class="row">
                    <div class="col-sm-4">
                        <label>类别</label>
                        <input type="text" class="form-control" name="category">
                    </div>
                    <div class="col-sm-4">
                        <label>类别中文名称</label>
                        <input type="text" class="form-control" name="category_cn_name">
                    </div>
                    <div class="col-sm-4">
                        <label>类别英文名称(必填)</label>
                        <input type="text" class="form-control" name="category_en_name" ng-model="en_name"
                               pattern="[^\u2E80-\u9FFF ]+" required>
                        <span style="color:red"
                              ng-show="add_editor_category.category_en_name.$dirty && add_editor_category.category_en_name.$invalid">
                            <span ng-show="add_editor_category.category_en_name.$invalid">类别英文名称不得含有中文字符。</span>
                        </span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label>相关描述</label>
                        <textarea class="form-control" name="description"></textarea>
                    </div>
                </div>
            </div>
            <div>
                <div class="col-sm-2 col-sm-offset-10" style="text-align: right;padding-right: 15px;padding-top: 15px">
                    <button type="button" class="confirm_add btn btn-primary" ng-disabled="add_editor_category.category_en_name.$invalid">确定添加
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="add_editor_type" class="row collapse">
        <form role="form" name="add_editor_type" novalidate >
            {% csrf_token %}
            <div class="container">
                <div class="row">
                    <div class="col-sm-3">
                        <label>类型</label>
                        <input type="text" class="form-control" name="type">
                    </div>
                    <div class="col-sm-3">
                        <label>类型中文名称</label>
                        <input type="text" class="form-control" name="type_cn_name">
                    </div>
                    <div class="col-sm-3">
                        <label>类型英文名称(必填)</label>
                        <input type="text" class="form-control" name="type_en_name" ng-model="type_en_name"
                               pattern="[^\u2E80-\u9FFF ]*" required>
                        <span style="color:red"
                              ng-show="add_editor_type.type_en_name.$dirty && add_editor_type.type_en_name.$invalid">
                            <span ng-show="add_editor_type.type_en_name.$invalid">类型英文名称为必填项且不得含有中文字符。</span>
                        </span>
                    </div>
                    <div class="col-sm-3">
                        <label>所属类别</label>
                        <select data-size="7" class="selectpicker form-control"
                                data-width="98%" data-first-option="false" required
                                name="category" title="请选择..."
                                data-live-search="true">
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label>相关描述</label>
                        <textarea class="form-control" name="description"></textarea>
                    </div>
                </div>
            </div>
            <div>
                <div class="col-sm-2 col-sm-offset-10" style="text-align: right;padding-right: 15px;padding-top: 15px">
                    <button type="button" class="confirm_add btn btn-primary" ng-disabled="add_editor_type.type_en_name.$invalid ||
                    add_editor_type.category_en_name.$invalid">确定添加
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="add_editor_brand" class="row collapse">
        <form role="form" name="add_editor_brand" novalidate >
            {% csrf_token %}
            <div class="container">
                <div class="row">
                    <div class="col-sm-4">
                        <label>品牌中文名称</label>
                        <input type="text" class="form-control" name="brand_cn_name">
                    </div>
                    <div class="col-sm-4">
                        <label>品牌英文名称(必填)</label>
                        <input type="text" class="form-control" required pattern="[^\u2E80-\u9FFF ]+"
                               name="brand_en_name" ng-model="brand_en_name">
                        <span style="color:red"
                              ng-show="add_editor_brand.brand_en_name.$dirty && add_editor_brand.brand_en_name.$invalid">
                            <span ng-show="add_editor_brand.brand_en_name.$invalid">品牌英文名称不能为空且不得含有中文字符。</span>
                        </span>
                    </div>
                    <div class="col-sm-4">
                        <label>品牌链接</label>
                        <input type="text" class="form-control" name="brand_link">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label>所在国家</label>
                        <select data-size="7" class="selectpicker form-control"
                                data-width="98%" data-first-option="false" required
                                name="country" title="请选择..."
                                data-live-search="true">
                            <option value="sdf">jskdfljs</option>
                            <option value="ttre">weed</option>
                            <option value="bbbbb">wfhyj</option>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <label>对应类别</label>
                        <select data-size="7" class="selectpicker form-control"
                                data-width="98%" data-first-option="false" required
                                name="category" title="请选择..."
                                data-live-search="true">
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <label>现有商品类型</label>
                        <select data-size="7" class="selectpicker form-control" multiple
                                data-width="98%" data-first-option="false" required
                                name="type" title="请选择..."
                                data-live-search="true">
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label>相关描述</label>
                        <textarea class="form-control" name="description"></textarea>
                    </div>
                </div>
            </div>
            <div>
                <div class="col-sm-2 col-sm-offset-10" style="text-align: right;padding-right: 15px;padding-top: 15px">
                    <button type="button" class="confirm_add btn btn-primary" ng-disabled="add_editor_brand.brand_en_name.$invalid">
                        确定添加
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="add_editor_model" class="row collapse">
        <form role="form" name="add_editor_model" novalidate >
            {% csrf_token %}
            <div class="container">
                <div class="row">
                    <div class="col-sm-4">
                        <label>型号(必填)</label>
                        <input type="text" class="form-control" required name="model" ng-model="model">
                        <span style="color:red"
                              ng-show="add_editor_model.model.$dirty && add_editor_model.model.$invalid">
                            <span ng-show="add_editor_model.model.$error.required">型号不能为空。</span>
                        </span>
                    </div>
                    <div class="col-sm-4">
                        <label>相关链接</label>
                        <input type="text" class="form-control" name="model_link">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label>对应类别</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="category" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                            <button type="button" class="btn btn-sm">test</button>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <label>对应类型</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="type" disabled="true" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <label>对应品牌</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="brand" disabled="true" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label>相关描述</label>
                        <textarea class="form-control" name="description"></textarea>
                    </div>
                </div>
            </div>
            <div>
                <div class="col-sm-2 col-sm-offset-10" style="text-align: right;padding-right: 15px;padding-top: 15px">
                    <button type="button" class="confirm_add btn btn-primary"
                            ng-disabled="add_editor_model.model.$error.required">确定添加
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="add_editor_fingerprint" class="row collapse">
        <form role="form" name="add_editor_fingerprint" novalidate >
            {% csrf_token %}
            <div class="container">
                <div class="row">
                    <div class="col-sm-3">
                        <label>准确度</label>
                        <input type="text" class="form-control" pattern="^([0-9]|[0-9]{2}|100)$" name="accuracy" ng-model="accuracy">
                        <span style="color:red"
                              ng-show="add_editor_fingerprint.accuracy.$dirty && add_editor_fingerprint.accuracy.$invalid">
                            <span ng-show="add_editor_fingerprint.accuracy.$invalid">精确度必须为1-100的整数。</span>
                        </span>
                    </div>
                    <div class="col-sm-3">
                        <label>匹配方式（必选）</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="match_type" ng-model="match_type" title="请选择..."
                                data-width="98%" data-first-option="false" required>
                            <option value="0">模糊匹配</option>
                            <option value="1">精确匹配</option>
                        </select>
                    </div>
                    <div class="col-sm-3">
                        <label>协议</label>
                        <input type="text" class="form-control" name="protocol">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <label>对应类别（必选）</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="category" ng-model="category" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                        </select>
                    </div>
                    <div class="col-sm-3">
                        <label>对应类型（必选）</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="type" disabled ng-model="type" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                        </select>
                    </div>
                    <div class="col-sm-3">
                        <label>对应品牌（必选）</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="brand" disabled ng-model="brand" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                        </select>
                    </div>
                    <div class="col-sm-3">
                        <label>对应型号</label>
                        <select data-size="7" class="selectpicker form-control"
                                name="model" disabled ng-model="model" title="请选择..."
                                data-width="98%" data-first-option="false" required
                                data-live-search="true">
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <label>server</label>
                        <input type="text" class="form-control" name="server">
                    </div>
                    <div class="col-sm-3">
                        <label>www_authenticate</label>
                        <input type="text" class="form-control" name="www_authenticate">
                    </div>
                    <div class="col-sm-3">
                        <label>title</label>
                        <input type="text" class="form-control" name="title">
                    </div>
                    <div class="col-sm-3">
                        <label>其它信息</label>
                        <input type="text" class="form-control" name="others">
                    </div>
                </div>
            </div>
            <div>
                <div class="col-sm-2 col-sm-offset-10" style="text-align: right;padding-right: 15px;padding-top: 15px">
                    <button type="button" class="confirm_add btn btn-primary" ng-disabled="
                     add_editor_fingerprint.accuracy.$invalid||add_editor_fingerprint.brand.$pristine
                     ||add_editor_fingerprint.match_type.$pristine">确定添加</button>
                </div>
            </div>
        </form>
    </div>
    <!--初始化添加功能编辑面板的类别与国家下拉框选项数据-->
    <script>
        // 初始化国家列表
        var selectpicker_brand_country = $("form[name = 'add_editor_brand'] select.selectpicker[name = 'country']");
        selectpicker_brand_country.empty();

        var url = "{% url 'display:get_all_countries' %}";
        $.get(url,
            function (data,status) {
                if (status === 'success') {
                    var result_json = eval('(' + data + ')');
                    // post to get_all_countries
                    for (x in result_json){
                        var optgroup = $('<optgroup label="' + x + '"></optgroup>');
                        var countries = result_json[x];
                        for (country_ind in countries){
                            var en_name = countries[country_ind].en_name;
                            var cn_name = countries[country_ind].cn_name;
                            var opt = $('<option value="' + en_name + '">' + cn_name + '</option>');
                            optgroup.append(opt);
                        }

                        selectpicker_brand_country.append(optgroup);
                    }
                } else {
                    Messenger().post("请求失败...");
                }
            });

        // 初始化类别列表
        var selectpicker_brand_category = $("form[name = 'add_editor_brand'] select.selectpicker[name = 'category']");
        selectpicker_brand_category.empty();

        var selectpicker_model_category = $("form[name = 'add_editor_model'] select.selectpicker[name = 'category']");
        selectpicker_model_category.empty();

        var selectpicker_fingerprint_category = $("form[name = 'add_editor_fingerprint'] select.selectpicker[name = 'category']");
        selectpicker_fingerprint_category.empty();

        var selectpicker_type_category = $("form[name = 'add_editor_type'] select.selectpicker[name = 'category']");
        selectpicker_type_category.empty();

        url = "{% url 'display:get_all_categories' %}";
        $.get(url,
            function (data,status) {
                if (status === 'success') {
                    var result_json = eval('(' + data + ')');
                    for (cat_ind in result_json){
                        var id = result_json[cat_ind].id;
                        var name = result_json[cat_ind].name;

                        var opt_0 = $('<option value="' + id + '">' + name + '</option>');
                        var opt_1 = $('<option value="' + id + '">' + name + '</option>');
                        var opt_2 = $('<option value="' + id + '">' + name + '</option>');
                        var opt_3 = $('<option value="' + id + '">' + name + '</option>');

                        selectpicker_brand_category.append(opt_0);
                        selectpicker_model_category.append(opt_1);
                        selectpicker_fingerprint_category.append(opt_2);
                        selectpicker_type_category.append(opt_3);
                    }
                } else {
                    Messenger().post("请求失败...");
                }
            });

        // 将其他下拉框设为disabled
        var sp_type = $("form select.selectpicker[name = 'type']");
        var sp_brand = $("form select.selectpicker[name = 'brand']");
        var sp_model = $("form select.selectpicker[name = 'model']");
        sp_type.prop("disabled",true);
        sp_brand.prop("disabled",true);
        sp_model.prop("disabled",true);
        sp_type.selectpicker("refresh");
        sp_brand.selectpicker("refresh");
        sp_model.selectpicker("refresh");
    </script>
    <div class="row results_content">
        {% include "device_display/table_selfdefined.html" %}
    </div>
</div>

{% include "device_display/pagination.html" %}

